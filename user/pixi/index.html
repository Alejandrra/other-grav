<!DOCTYPE HTML>
<html>
	<head>
		<title>PIXI Concentration</title>
		<style>
			body {
				margin: 0;
				padding: 0;
			}
		</style>
		<script src="pixi.dev.js"></script>
		<script src="pixi-sound.js"></script>
	</head>
	
	<body>
		

			 <audio id="myaudio" controls>
					<source src= "sound/incorrecto.mp3" type="audio/mpeg">	
				    		
			</audio>

			<audio id="myAudio" controls>
					<source src= "sound/mario-bros-1-up.mp3" type="audio/mpeg">	
				    		
			</audio>

			<audio id="fondoaudio" controls>
				<source src= "sound/ringtones-super-mario-bros.mp3" type="audio/mpeg">	
						
		</audio>

			
			              <p id = "Score"> </p> 

		<script>
			document.body.style.backgroundImage="url('giphy.jpg/ae29a34db3d94478ae91ff80dc558888-0.jpg')";
			var a = document.getElementById("myaudio");
			var nivel = 1;
			var tamañoX = 4 ;
			var tamañoY = 6 ;
			var x= 720 ;
			var y= 780 ;
			var fichas = tamañoX * tamañoY;
		var puntaje=0;
			// first tile picked up by the player
			var firstTile=null;
			// second tile picked up by the player
			var secondTile=null;
			// can the player pick up a tile?
			var canPick=true;
			// create an new instance of a pixi stage with a grey background
			var stage = new PIXI.Stage(0x888888);
			// create a renderer instance width=640 height=480
			var renderer = PIXI.autoDetectRenderer(318,315);
			// importing a texture atlas created with texturepacker
			var tileAtlas = ["images.json"];
			// create a new loader
			var loader = new PIXI.AssetLoader(tileAtlas);
			// create an empty container
			var gameContainer = new PIXI.DisplayObjectContainer();
			// add the container to the stage
			 stage.addChild(gameContainer);
			 
     		// add the renderer view element to the DOM
			document.body.appendChild(renderer.view);
			// use callback
			loader.onComplete = onTilesLoaded
			//begin load
		  
			loader.load();
			
			c=document.getElementById("fondoaudio");
			c.autoplay=true;//audio
			c.load();

			function onTilesLoaded(){
				// choose 24 random tile images
				var chosenTiles=new Array();
				while(chosenTiles.length<48){
					var candidate=Math.floor(Math.random()*44);
					if(chosenTiles.indexOf(candidate)==-1){
						chosenTiles.push(candidate,candidate)
					}			
				}
				// shuffle the chosen tiles
				for(i=0;i<(tamañoX * tamañoY) * 2;i++){
					var from = Math.floor(Math.random()*(tamañoX * tamañoY));
					var to = Math.floor(Math.random()*(tamañoX * tamañoY));
					var tmp = chosenTiles[from];
					chosenTiles[from]=chosenTiles[to];
					chosenTiles[to]=tmp;
				}
				// place down tiles
				for(i=0;i<tamañoX;i++){
					for(j=0;j<tamañoY;j++){
						// new sprite
						var tile = PIXI.Sprite.fromFrame(chosenTiles[i*6+j]);
						// buttonmode+interactive = acts like a button
						tile.buttonMode=true;
						tile.interactive = true;
						// is the tile selected?
						tile.isSelected=false;
						// set a tile value
						tile.theVal=chosenTiles[i*6+j]
						// place the tile
						tile.position.x = 7+i*80;
						tile.position.y = 7+j*80;
						// paint tile black
						tile.tint = 0x000000;
						// set it a bit transparent (it will look grey)
						tile.alpha=0.5;
						// add the tile
						gameContainer.addChild(tile);
						// mouse-touch listener
						tile.mousedown = tile.touchstart = function(data){
							// can I pick a tile?
							if(canPick) {
							     // is the tile already selected?
								if(!this.isSelected){
									// set the tile to selected
									this.isSelected = true;
									// show the tile
				      				this.tint = 0xffffff;
									this.alpha = 1;
									// is it the first tile we uncover?
									if(firstTile==null){
										firstTile=this
									}
									// this is the second tile
									else{
										secondTile=this
										// can't pick anymore
										canPick=false;
										// did we pick the same tiles?
										if(firstTile.theVal==secondTile.theVal){
											// wait a second then remove the tiles and make the player able to pick again
											setTimeout(function(){
												gameContainer.removeChild(firstTile);
												gameContainer.removeChild(secondTile);
												firstTile=null;
												secondTile=null;
												canPick=true;
											},1000);
											var b= puntaje;
											puntaje = puntaje + 20 ;
											b=document.getElementById("myAudio");
											b.autoplay=true;//audio
											b.load();

											document.getElementById('Score').innerHTML = "Tu Puntaje es: " + puntaje + " Nivel: " + nivel;
										
 
											// indicamos el archivo de audio a cargar
				    		
	  
											if(fichas==0){
											
											alert("Felicitaciones por culminar el juego")
											nivel=nivel+1;
										    switch (nivel) {
											case 2: 
											tamañoX=5;
											tamañoY=6;
											x=315;
											y=315;
									       fichas=tamañoX*tamañoY
											  b.load();
											  document.getElementById('Score').innerHTML = "Tu Puntaje es: " + puntaje + " Nivel: " + nivel;
											 break;
											 
											 case 3: 
											tamañoX=6;
											tamañoY=6;
											x=600;
											y=680;
									       fichas=tamañoX*tamañoY;
											  b.load();
											  document.getElementById('Score').innerHTML = "Tu Puntaje es: " + puntaje + " Nivel: " + nivel;
											 break;
																					
											 case 4: 
											tamañoX=8;
											tamañoY=8;
											x=480;
											y=640;
									       fichas=tamañoX*tamañoY;
											  //onTilesLoaded();
											b.load();
											  document.getElementById('Score').innerHTML = "Tu Puntaje es: " + puntaje + " Nivel: " + nivel;
											 break;
											}
 												 
											
										}
										}
												
								
										// we picked different tiles
										else{
											// wait a second then cover the tiles and make the player able to pick again
								 			setTimeout(function(){
								 				firstTile.isSelected=false
								 				secondTile.isSelected=false
								 				firstTile.tint = 0x000000;
								 				secondTile.tint = 0x000000;
								 				firstTile.alpha=0.5;
								 				secondTile.alpha=0.5;
								 				firstTile=null;
												secondTile=null;
												canPick=true
												a.autoplay=true;//audio
												a.load();
												puntaje=puntaje-2;
											 document.getElementById('Score').innerHTML = "Tu Puntaje es: " + puntaje + " Nivel: " + nivel;
											 },1000);
											 
										}
									}	
								}
							}
						}
					}
				} 
				requestAnimFrame(animate);
			}
			function animate() {
				requestAnimFrame(animate);
				renderer.render(stage);
			}
		</script>
	</body>
</html>




